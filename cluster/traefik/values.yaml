# === Service exposure via MetalLB ===
service:
  enabled: true
  type: LoadBalancer
  annotations:
    metallb.universe.tf/loadBalancerIPs: "$(LB_IP_TRAEFIK)"
  externalTrafficPolicy: Local
  ports:
    web: $(TRAEFIK_PORT_HTTP)
    websecure: $(TRAEFIK_PORT_HTTPS)

# === Core providers ===
providers:
  kubernetesCRD:
    enabled: true
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true      

# === Persistence for ACME certs ===
persistence:
  enabled: true
  path: /data
  size: 1Gi
  accessMode: ReadWriteOnce

# === Cert resolver (DNS-01 with Cloudflare) ===
deployment:
  additionalArguments:
    - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
    - "--entrypoints.web.http.redirections.entrypoint.scheme=https"
    - "--certificatesresolvers.cloudflare.acme.email=${ACME_EMAIL}"  
    - "--certificatesresolvers.cloudflare.acme.dnschallenge.provider=cloudflare"
    - "--certificatesresolvers.cloudflare.acme.storage=/data/acme.json"
  envFrom:
    - secretRef: { name: traefik-acme }

ingressClass:
  enabled: true
  isDefaultClass: true         
  name: traefik

pilot:
  enabled: false
ports:
  traefik:
    expose: false