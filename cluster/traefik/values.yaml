# === Service exposure via MetalLB ===
service:
  enabled: true
  type: LoadBalancer
  annotations:
    metallb.universe.tf/loadBalancerIPs: "192.168.0.169"   # your chosen LB IP
  ports:
    web: 80
    websecure: 443

# === Core providers ===
providers:
  kubernetesCRD:
    enabled: true
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true      # lets Traefik discover its external IP for HTTPS redirects, etc.

# === Persistence for ACME certs ===
persistence:
  enabled: true
  path: /data
  size: 1Gi
  accessMode: ReadWriteOnce

# === Cert resolver (DNS-01 with Cloudflare) ===
# We pass ACME settings via CLI and the token via envFrom (secret).
deployment:
  additionalArguments:
    - "--entrypoints.web.http.redirections.entrypoint.to=websecure"
    - "--entrypoints.web.http.redirections.entrypoint.scheme=https"
    - "--certificatesresolvers.cloudflare.acme.email=you@bijouxlabs.cc"
    - "--certificatesresolvers.cloudflare.acme.dnschallenge.provider=cloudflare"
    - "--certificatesresolvers.cloudflare.acme.storage=/data/acme.json"
    # Optional but handy if your CF zone is proxied elsewhere:
    # - "--certificatesresolvers.cloudflare.acme.dnschallenge.disablePropagationCheck=true"
  envFrom:
    - secretRef:
        name: cloudflare-api-token

# Optional: name your ingressClass
ingressClass:
  enabled: true
  isDefaultClass: true         # makes Traefik the default Ingress controller
  name: traefik
